<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KINAFLIX TV - Live Stream</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e50914">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js"></script>
</head>
<body>
    <!-- Name Modal -->
    <div class="modal" id="nameModal">
        <div class="modal-content">
            <div class="logo">
                <i class="fas fa-tv"></i>
                <span>KINAFLIX TV</span>
            </div>
            <h2>Welcome to Free Streaming</h2>
            <p>Enter a name to join the chat (optional):</p>
            <input type="text" id="userName" placeholder="Your name (optional)" maxlength="20">
            <button class="btn btn-primary" id="joinBtn">
                <i class="fas fa-play"></i> Start Watching Free
            </button>
            <p class="modal-note">
                <i class="fas fa-lock"></i> No registration • <i class="fas fa-shield-alt"></i> Anonymous • <i class="fas fa-check"></i> Free Forever
            </p>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="viewer-container" id="mainInterface" style="display: none;">
        <!-- Header -->
        <header class="stream-header">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-tv"></i>
                    <span>KINAFLIX TV</span>
                </div>
                <div class="stream-info">
                    <span class="live-indicator">
                        <i class="fas fa-circle"></i> LIVE
                    </span>
                    <span class="video-title" id="currentVideoTitle">Loading stream...</span>
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-icon" id="fullscreenBtn" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="btn btn-icon" id="installBtn" title="Install App">
                    <i class="fas fa-download"></i>
                </button>
                <a href="index.html" class="btn btn-secondary btn-small">
                    <i class="fas fa-home"></i> Home
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="stream-main">
            <!-- Video Player -->
            <div class="video-section">
                <div class="video-container">
                    <video id="videoPlayer" playsinline autoplay muted></video>
                    <div class="player-overlay">
                        <div class="player-controls">
                            <button class="control-btn" id="playPauseBtn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="control-btn" id="muteBtn">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button class="control-btn" id="nextBtn" title="Next Video">
                                <i class="fas fa-forward"></i>
                            </button>
                        </div>
                        <div class="video-progress">
                            <div class="progress-bar" id="progressBar"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Section (TOP POSITION) -->
            <div class="chat-section-top">
                <div class="chat-container">
                    <!-- Chat Input at TOP -->
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="Type a message... (optional)" disabled>
                        <button class="btn btn-primary btn-small" id="sendBtn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <!-- Messages Container (Reversed - messages go UP) -->
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be inserted at the BOTTOM and flow UP -->
                        <div class="system-message">
                            Welcome to KINAFLIX TV! Start watching free content 24/7.
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>
    <!-- Main App -->
    <script src="app.js"></script>
    <!-- Video Player -->
    <script src="player.js"></script>
    <!-- Chat System -->
    <script src="chat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Handle name modal
            const userName = localStorage.getItem('kinaflix_username') || '';
            const nameModal = document.getElementById('nameModal');
            const mainInterface = document.getElementById('mainInterface');
            
            if (userName) {
                // Skip modal if already have name
                nameModal.style.display = 'none';
                mainInterface.style.display = 'flex';
                window.kinaflix.setUserName(userName);
            } else {
                // Show modal
                nameModal.style.display = 'flex';
                
                document.getElementById('joinBtn').addEventListener('click', () => {
                    const inputName = document.getElementById('userName').value.trim();
                    const finalName = inputName || 'Viewer' + Math.floor(Math.random() * 1000);
                    
                    localStorage.setItem('kinaflix_username', finalName);
                    window.kinaflix.setUserName(finalName);
                    
                    nameModal.style.display = 'none';
                    mainInterface.style.display = 'flex';
                });
                
                // Enter key support
                document.getElementById('userName').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('joinBtn').click();
                    }
                });
            }
            
            // Fullscreen toggle
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            });
            
            // PWA install
            let deferredPrompt;
            const installBtn = document.getElementById('installBtn');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installBtn.style.display = 'block';
            });
            
            installBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => {
                        deferredPrompt = null;
                        installBtn.style.display = 'none';
                    });
                }
            });
            
            // Fullscreen change
            document.addEventListener('fullscreenchange', () => {
                const icon = document.querySelector('#fullscreenBtn i');
                if (document.fullscreenElement) {
                    icon.className = 'fas fa-compress';
                } else {
                    icon.className = 'fas fa-expand';
                }
            });
        });
    </script>
</body>
</html>
